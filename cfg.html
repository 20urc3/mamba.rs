<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mamba — CFG Construction</title>
  <!-- MathJax for proper formula rendering -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$']]
      },
      svg: { fontCache: 'global' }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    /*****  PALETTE  *****/
    :root {
      --accent: #0a84ff;
      --text: #1c1c1e;
      --bg: #ffffff;
      --card: #f3f4f6;
      --code: #f5f5f7;
      --max: 820px;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --text: #e7e7e7;
        --bg: #26262a;
        --card: #323236;
        --code: #2a2a2e;
      }
    }
    /*****  RESET & BASE  *****/
    * { box-sizing: border-box; margin: 0; padding: 0 }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.7;
      display: flex;
      justify-content: center;
      padding: 3rem 1rem;
    }
    main { max-width: var(--max); width: 100% }
    /*****  TYPOGRAPHY  *****/
    h1 { font-size: 2.4rem; font-weight: 700; text-align: center; margin-bottom: 1.5rem }
    h2 { font-size: 1.6rem; font-weight: 600; text-align: center; margin: 2.5rem 0 1.2rem }
    p, li { font-size: 1rem; margin-bottom: .6rem }
    /*****  COMPONENTS  *****/
    .box {
      background: var(--card);
      padding: 1.8rem;
      border-radius: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,.05);
      margin-bottom: 2rem;
    }
    pre {
      background: var(--code);
      padding: 1.5rem;
      border-radius: 20px;
      overflow: auto;
      font-size: .9rem;
      margin-bottom: 2rem;
    }
    code { font-family: "SFMono-Regular", Consolas, Menlo, monospace; tab-size: 2 }
    ul { padding-left: 1.4rem; list-style: square }
    ol { margin-left: 1.2rem }
    a { color: var(--accent); text-decoration: none; font-weight: 500 }
    a:hover { text-decoration: underline }
    footer { text-align: center; margin-top: 3.5rem; font-size: .85rem }
  </style>
</head>
<body>
  <main>
    <h1>Control-Flow Graph Construction</h1>

<h2>Problem definition</h2>
<div class="box">
  <p>A control-flow graph (CFG) is a representation, using graph notation, of all paths that might be traversed through a program during its execution. 
    <br>In a control-flow graph each node in the graph represents a basic block, i.e. a straight-line sequence of code with a single entry point and a single exit point, where no branches or jumps occur within the block. Directed edges are used to represent jumps in the control flow. 
    <br>There are, in most presentations, two specially designated blocks: the entry block, through which control enters into the flow graph, and the exit block, through which all control flow leaves. 
    <br>Building a CFG is purely a syntatic process, we split code into basic blocks and link them based on the branch or jump instruction we see. <br><br>Which makes it a decidable (meaning we can achieve a perfectly accurate CFG) because:
<br>
<br>1. We only look at each instruction once:
<br>- Scan the code top to bottom to identify basic block boundaries (leaders) and terminators (br, switch, return, etc)
<br>- No recursive or infinite reasonning, every jump target is expliclty named in the text
<br>2. Edges come directly from the code:
<br>- For each block terminator:
<br>-> We determine if it's a True/False/Exit branch
</div>

<h2>Plain text algorithm</h2>
<div class="box">
  <p>We perform these phases in one pass over all basic blocks:</p>
  <ol>
    <li>
      <strong>Identify blocks:</strong>
      <ul>
        <li>Scan code top-to-bottom, marking leaders (function start, branch targets, fall-throughs).</li>
        <li>Partition the code into basic blocks so each has a single entry and exit.</li>
      </ul>
    </li>
    <li>
      <strong>Initialize:</strong>
      <ul>
        <li>Give each block empty <code>predecessors</code> and <code>successors</code> lists.</li>
        <li>Choose the first block as the entry.</li>
        <li>Optionally, create a dummy exit block.</li>
      </ul>
    </li>
    <li>
      <strong>Link edges:</strong>
      <ul>
        <li>For each block <code>B</code>, examine its terminator:</li>
        <li> <em>Unconditional</em> <code>br L</code>: add edge <code>(B → L)</code>.</li>
        <li> <em>Conditional</em> <code>br i1 c, T, F</code>: add edges <code>(B → T)</code> and <code>(B → F)</code>.</li>
        <li> <em>Return</em>: if using a dummy exit, add edge <code>(B → exit)</code>; otherwise leave <code>B.successors</code> empty.</li>
        <li>Record each connection in both <code>successors</code> and <code>predecessors</code>.</li>
      </ul>
    </li>
    <li>
      <strong>Complete:</strong>
      <ul>
        <li>The entry block is the CFG’s start; any block with no successors is an exit (or the dummy exit).</li>
      </ul>
    </li>
  </ol>
</div>

<h2>Pseudo-code</h2>
<pre><code>for each basic block B:

identify leaders and split into blocks
initialize B.predecessors = \[], B.successors = \[]
choose entry = first block
optionally create dummy exit block

for each block B:
let term = B.terminator
if term is "br L":
add edge (B → L)
if term is "br i1 c, T, F":
add edges (B → T), (B → F)
if term is "return":
if dummy exit exists:
add edge (B → exit)

record each edge in B.successors and target.predecessors</code></pre>

<h2>Mathematical Formulation</h2>
<div class="box" style="background: var(--code); padding: 1rem;">
  <div style="font-size: 1.3em; text-align: center; margin-bottom: 1rem;">
    $$\mathrm{CFG} = (B, E, \mathit{entry}, \mathit{exit})$$
    $$E = \{\,(b, b') \mid b,b' \in B,\; b' \text{ is a target of } b\}'\text{s terminator}\}$$
  </div>
  <p><em>Notation:</em></p>
  <ul>
    <li><strong>B</strong> — set of all basic blocks</li>
    <li><strong>E</strong> — set of directed edges between blocks</li>
    <li><strong>entry</strong> — the start block in <strong>B</strong></li>
    <li><strong>exit</strong> — the end block (or dummy) in <strong>B</strong></li>
  </ul>
</div>

<footer>
  <a href="index.html">&larr; Back to main page</a>
</footer>

  </main>
</body>
</html>
